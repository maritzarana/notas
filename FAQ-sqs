ğŸ“Œ FAQ - Preguntas Frecuentes sobre DLQ (Dead Letter Queue) en AWS Lambda

1ï¸âƒ£ Â¿Es obligatorio usar una DLQ en AWS Lambda?

No, no es obligatorio, pero puede ser Ãºtil en ciertos escenarios.
	â€¢	Si tu Lambda procesa eventos asÃ­ncronos (como S3, SNS, EventBridge) y no quieres perder datos en caso de fallo, sÃ­ es recomendable.
	â€¢	Si tu Lambda es sÃ­ncrona (por ejemplo, invocada desde API Gateway o AWS SDK), los errores se devuelven al cliente y una DLQ no es necesaria.

2ï¸âƒ£ Â¿QuÃ© tipo de colas se pueden usar como DLQ en Lambda?

Puedes usar:
âœ… Amazon SQS (Simple Queue Service) â†’ Guarda eventos fallidos para reprocesarlos despuÃ©s.
âœ… Amazon SNS (Simple Notification Service) â†’ EnvÃ­a notificaciones cuando una Lambda falla.

3ï¸âƒ£ Â¿Lambda reprocesa automÃ¡ticamente los eventos de la DLQ?

No, Lambda NO reprocesa automÃ¡ticamente los eventos almacenados en la DLQ.
	â€¢	Si configuras una SQS DLQ, los mensajes fallidos quedarÃ¡n en la cola, pero debes configurar otra Lambda para leerlos y reprocesarlos manualmente.

ğŸ”¹ SoluciÃ³n: Agregar un Trigger de SQS a una Lambda que vuelva a ejecutar los eventos fallidos.

4ï¸âƒ£ Â¿CuÃ¡ntos reintentos hace Lambda antes de enviar un evento a la DLQ?
	â€¢	Si la Lambda se ejecuta de manera asÃ­ncrona (por S3, EventBridge, SNS, etc.), AWS reintenta automÃ¡ticamente 2 veces antes de enviar el evento fallido a la DLQ.
	â€¢	Si es una invocaciÃ³n sÃ­ncrona, Lambda no hace reintentos y devuelve el error directamente.

5ï¸âƒ£ Â¿CuÃ¡l es la diferencia entre una DLQ y Lambda Destinations?

CaracterÃ­stica	DLQ (SQS/SNS)	Lambda Destinations
Â¿Guarda eventos fallidos?	âœ… SÃ­	âœ… SÃ­
Â¿Ejecuta otra acciÃ³n despuÃ©s de un fallo?	âŒ No (solo almacena mensajes)	âœ… SÃ­ (puede ejecutar otra Lambda o enviar a EventBridge)
Â¿Requiere configuraciÃ³n manual para reprocesar?	âœ… SÃ­	âŒ No (se gestiona automÃ¡ticamente)
Casos de uso	Guardar mensajes para anÃ¡lisis y reprocesar manualmente	Disparar otra acciÃ³n automÃ¡tica en caso de fallo

ğŸ”¹ Usa DLQ si necesitas guardar y revisar eventos fallidos.
ğŸ”¹ Usa Lambda Destinations si quieres que otro servicio actÃºe automÃ¡ticamente despuÃ©s de un fallo.

6ï¸âƒ£ Â¿CÃ³mo recibir una alerta si mi Lambda falla?

Puedes configurar una alarma en CloudWatch para detectar errores y enviarte un email/SMS con SNS:
	1.	Ve a la consola de CloudWatch â†’ Alarmas â†’ Crear Alarma.
	2.	Selecciona la mÃ©trica â€œErrorsâ€ de tu Lambda.
	3.	Crea una condiciÃ³n para cuando los errores sean > 0.
	4.	AÃ±ade una acciÃ³n con SNS para recibir notificaciones.

7ï¸âƒ£ Â¿CÃ³mo agregar una DLQ a una Lambda desde AWS CLI?

Puedes agregar una SQS DLQ a tu Lambda con este comando:

aws lambda update-function-configuration \
  --function-name MiLambda \
  --dead-letter-config TargetArn=arn:aws:sqs:us-east-1:123456789012:MiDLQ

8ï¸âƒ£ Â¿CÃ³mo procesar los mensajes de la DLQ automÃ¡ticamente?

Debes crear una Lambda que tenga la DLQ como trigger y vuelva a ejecutar los eventos fallidos:

import boto3
import json

lambda_client = boto3.client('lambda')
sqs_client = boto3.client('sqs')

DLQ_URL = "https://sqs.us-east-1.amazonaws.com/123456789012/MiDLQ"

def lambda_handler(event, context):
    messages = sqs_client.receive_message(QueueUrl=DLQ_URL, MaxNumberOfMessages=5, WaitTimeSeconds=10)

    if "Messages" in messages:
        for message in messages["Messages"]:
            event_data = json.loads(message["Body"])

            lambda_client.invoke(
                FunctionName="MiLambdaOriginal",
                InvocationType="Event",
                Payload=json.dumps(event_data)
            )

            sqs_client.delete_message(QueueUrl=DLQ_URL, ReceiptHandle=message["ReceiptHandle"])

    return "Reprocesado"

9ï¸âƒ£ Â¿DÃ³nde se configuran los triggers en Lambda?
	1.	Ve a la consola de AWS Lambda.
	2.	Selecciona la funciÃ³n Lambda.
	3.	Ve a la pestaÃ±a â€œTriggersâ€ (Desencadenadores).
	4.	Haz clic en â€œAgregar triggerâ€ y selecciona SQS.
	5.	Elige la DLQ (SQS) como fuente de eventos.

ğŸ”Ÿ Â¿CuÃ¡ndo NO es necesario configurar una DLQ en Lambda?

No necesitas una DLQ si:
âŒ Tu Lambda se invoca de manera sÃ­ncrona (API Gateway, AWS SDK).
âŒ Puedes volver a ejecutar la Lambda manualmente sin perder informaciÃ³n.
âŒ Prefieres usar CloudWatch Logs + Alarmas para monitorear errores en lugar de almacenar eventos en una SQS.

ğŸ”¹ Â¿Tienes mÃ¡s preguntas o necesitas ayuda con la configuraciÃ³n? ğŸš€